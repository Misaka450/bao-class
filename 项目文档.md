# ğŸš€ å°å­¦æˆç»©ç®¡ç†ç³»ç»Ÿ (Elementary School Grade Management System)

## 1. é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€æ™ºèƒ½åŒ–çš„ Serverless å°å­¦æˆç»©ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒç®¡ç†å‘˜ã€ç­ä¸»ä»»ã€ç§‘ä»»æ•™å¸ˆä¸‰ç±»è§’è‰²ã€‚ç³»ç»Ÿé€šè¿‡é«˜æ•ˆçš„æ‰¹é‡å¯¼å…¥ã€AI æ™ºèƒ½åˆ†æï¼ˆåˆ©ç”¨ Cloudflare Workers AIï¼‰å’Œ Serverless éƒ¨ç½²ï¼Œæå‡æˆç»©ç®¡ç†çš„æ•ˆç‡å’Œæ•™å­¦æŒ‡å¯¼çš„è´¨é‡ã€‚

**æ ¸å¿ƒç›®æ ‡ï¼š**
- **é«˜æ•ˆç®¡ç†**ï¼šæ”¯æŒ Excel æ‰¹é‡å¯¼å…¥ + AI å›¾ç‰‡è¯†åˆ«å¯¼å…¥æˆç»©
- **æ™ºèƒ½åˆ†æ**ï¼šåˆ©ç”¨ AI ç”Ÿæˆä¸ªæ€§åŒ–è¯„è¯­å’Œç­çº§å­¦æƒ…æŠ¥å‘Š
- **å…¨æ ˆ Serverless**ï¼šåŸºäº Cloudflare Workers, Pages, D1, R2 æ„å»º

## ğŸ’» 2. æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯/æœåŠ¡ | ç‰ˆæœ¬ | ç”¨é€”è¯´æ˜ |
|------|----------|------|----------|
| **å‰ç«¯æ¡†æ¶** | React + TypeScript | 19.2.x | æ„å»ºç”¨æˆ·ç•Œé¢ |
| **UI æ¡†æ¶** | Ant Design + Pro Components | 5.24.x | ä¼ä¸šçº§ UI ç»„ä»¶ |
| **å›¾è¡¨åº“** | Recharts | 3.4.x | æ•°æ®å¯è§†åŒ– |
| **çŠ¶æ€ç®¡ç†** | React Query + Zustand | 5.x | æœåŠ¡ç«¯/å®¢æˆ·ç«¯çŠ¶æ€ |
| **è·¯ç”±** | React Router | 7.x | å‰ç«¯è·¯ç”± |
| **åç«¯æ ¸å¿ƒ** | Cloudflare Workers (Hono.js) | 4.x | API æ¥å£ã€ä¸šåŠ¡é€»è¾‘ |
| **æ•°æ®åº“** | Cloudflare D1 | - | å­˜å‚¨ç»“æ„åŒ–æ•°æ® |
| **æ–‡ä»¶å­˜å‚¨** | Cloudflare R2 | - | å­˜å‚¨å›¾ç‰‡ã€æ–‡ä»¶ |
| **å›¾ç‰‡ä¼˜åŒ–** | Cloudflare Image Resizing | - | åŠ¨æ€å›¾ç‰‡ç¼©æ”¾ |
| **AI æ ¸å¿ƒ** | DeepSeek-V3.2 | - | è¯„è¯­ç”Ÿæˆã€å­¦æƒ…æŠ¥å‘Šï¼ˆDashScope APIï¼‰ |
| **AI OCR** | Qwen3-VL-8B | - | å›¾ç‰‡æˆç»©è¯†åˆ«ï¼ˆDashScope APIï¼‰ |
| **ç¼“å­˜å±‚** | Cloudflare KV | - | AI è¯„è¯­åˆ†å¸ƒå¼ç¼“å­˜ |
| **éƒ¨ç½²** | Cloudflare Pages & Workers | - | å‰åç«¯åˆ†ç¦»éƒ¨ç½² |

## ğŸ›ï¸ 3. ç³»ç»Ÿæ¶æ„

| å±‚æ¬¡ | ç»„ä»¶ | èŒè´£ | ç»‘å®šåç§° |
|------|------|------|----------|
| **å‰ç«¯åº”ç”¨** | Cloudflare Pages | æ‰˜ç®¡ React é™æ€èµ„æº | - |
| **API ç½‘å…³** | Hono.js Worker | å¤„ç† API è¯·æ±‚ (/api/*) | - |
| **æ•°æ®å±‚** | Cloudflare D1 | å…³ç³»å‹æ•°æ®å­˜å‚¨ | DB |
| **å­˜å‚¨å±‚** | Cloudflare R2 | å¯¹è±¡å­˜å‚¨ (å›¾ç‰‡/æ–‡ä»¶) | ASSET_BUCKET |
| **æ™ºèƒ½å±‚** | Workers AI | LLM æ¨ç†åˆ†æ | AI |

## ğŸ§± 4. æ•°æ®åº“è®¾è®¡ (Cloudflare D1)

### æ ¸å¿ƒè¡¨ç»“æ„

1. **Users è¡¨ (users)**
   - `id`: INTEGER PRIMARY KEY
   - `username`: TEXT UNIQUE (ç™»å½•è´¦å·)
   - `password`: TEXT (bcrypt åŠ å¯†)
   - `role`: TEXT (admin/head_teacher/subject_teacher)
   - `name`: TEXT (æ˜¾ç¤ºå§“å)
   - `created_at`: TIMESTAMP

2. **Classes è¡¨ (classes)**
   - `id`: INTEGER PRIMARY KEY
   - `name`: TEXT (ç­çº§åç§°)
   - `grade`: INTEGER (å¹´çº§)
   - `teacher_id`: INTEGER (ç­ä¸»ä»»ID, å¤–é”® users.id)
   - `created_at`: TIMESTAMP

3. **Class Subject Teachers è¡¨ (class_subject_teachers)**
   - `id`: INTEGER PRIMARY KEY
   - `class_id`: INTEGER (ç­çº§ID)
   - `teacher_id`: INTEGER (æ•™å¸ˆID)
   - `subject`: TEXT (ç§‘ç›®)

4. **Students è¡¨ (students)**
   - `id`: INTEGER PRIMARY KEY
   - `name`: TEXT (å­¦ç”Ÿå§“å)
   - `student_id`: TEXT (å­¦å·, Unique)
   - `class_id`: INTEGER (ç­çº§ID, å¤–é”® classes.id)
   - `created_at`: TIMESTAMP

5. **Courses è¡¨ (courses)**
   - `id`: INTEGER PRIMARY KEY
   - `name`: TEXT (è¯¾ç¨‹åç§°)
   - `grade`: INTEGER (é€‚ç”¨å¹´çº§)

6. **Exams è¡¨ (exams)**
   - `id`: INTEGER PRIMARY KEY
   - `name`: TEXT (è€ƒè¯•åç§°)
   - `course_id`: INTEGER (è¯¾ç¨‹ID)
   - `class_id`: INTEGER (ç­çº§ID)
   - `exam_date`: TEXT (è€ƒè¯•æ—¥æœŸ)
   - `full_score`: INTEGER (æ»¡åˆ†)

7. **Scores è¡¨ (scores)**
   - `id`: INTEGER PRIMARY KEY
   - `student_id`: INTEGER (å­¦ç”ŸID)
   - `exam_id`: INTEGER (è€ƒè¯•ID)
   - `score`: REAL (åˆ†æ•°)
   - `created_at`: TIMESTAMP

8. **AI Comments è¡¨ (ai_comments)**
   - `id`: INTEGER PRIMARY KEY AUTOINCREMENT
   - `student_id`: INTEGER (å­¦ç”ŸID, å¤–é”® students.id)
   - `exam_id`: INTEGER (å…³è”è€ƒè¯•IDï¼Œå¯ä¸ºç©º)
   - `comment`: TEXT (è¯„è¯­å†…å®¹)
   - `metadata`: TEXT (JSON å­—ç¬¦ä¸²ï¼Œå­˜å‚¨ avg_score, trend, subjects ç­‰)
   - `edited`: INTEGER (0=åŸå§‹ç”Ÿæˆ, 1=å·²æ‰‹åŠ¨ç¼–è¾‘)
   - `created_at`: TIMESTAMP
   - `updated_at`: TIMESTAMP

9. **AI Class Reports è¡¨ (ai_class_reports)**
   - `id`: INTEGER PRIMARY KEY AUTOINCREMENT
   - `class_id`: INTEGER (ç­çº§ID, å¤–é”® classes.id)
   - `exam_id`: INTEGER (è€ƒè¯•ID, å¤–é”® exams.id)
   - `report_content`: TEXT (Markdown æ ¼å¼æŠ¥å‘Šå†…å®¹)
   - `created_at`: TIMESTAMP
   - `updated_at`: TIMESTAMP
   - *UNIQUE(class_id, exam_id)*

## âš™ï¸ 5. API æ¥å£

### 5.1 è®¤è¯ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• |
| GET | `/api/auth/profile` | è·å–ç”¨æˆ·ä¿¡æ¯ |

### 5.2 åŸºç¡€ç®¡ç† (CRUD)

| æ¨¡å— | è·¯å¾„å‰ç¼€ | è¯´æ˜ |
|------|----------|------|
| ç­çº§ç®¡ç† | `/api/classes` | GET/POST/PUT/DELETE |
| å­¦ç”Ÿç®¡ç† | `/api/students` | GET/POST/PUT/DELETE |
| è¯¾ç¨‹ç®¡ç† | `/api/courses` | GET/POST/PUT/DELETE |
| è€ƒè¯•ç®¡ç† | `/api/exams` | GET/POST/PUT/DELETE |
| æˆç»©ç®¡ç† | `/api/scores` | GET/POST/PUT/DELETE |
| ç”¨æˆ·ç®¡ç† | `/api/users` | GET/POST/PUT/DELETE |

### 5.3 æ‰¹é‡å¯¼å…¥ä¸æ–‡ä»¶

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/template/grades.xlsx` | ä¸‹è½½æˆç»©å¯¼å…¥æ¨¡æ¿ |
| POST | `/api/import/grades` | Excel æ‰¹é‡å¯¼å…¥æˆç»© |
| POST | `/api/import/ai-scores` | AI è¯†åˆ«å›¾ç‰‡å¯¼å…¥æˆç»© |
| POST | `/api/assets/upload` | ä¸Šä¼ æ–‡ä»¶åˆ° R2 |

### 5.4 ç»Ÿè®¡åˆ†æ

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/stats/class/:classId` | ç­çº§ç»Ÿè®¡åˆ†æ |
| GET | `/api/stats/profile/:studentId` | å­¦ç”Ÿæ¡£æ¡ˆæ•°æ® |
| GET | `/api/stats/class-trend/:classId` | ç­çº§æˆç»©è¶‹åŠ¿ |
| GET | `/api/stats/class-subject-trend/:classId` | ç­çº§ç§‘ç›®è¶‹åŠ¿ |
| GET | `/api/stats/grade-comparison/:classId` | å¹´çº§ç­çº§å¯¹æ¯” |
| GET | `/api/stats/distribution/:classId` | æˆç»©åˆ†å¸ƒç»Ÿè®¡ |
| GET | `/api/stats/rankings/:classId` | å­¦ç”Ÿæ’åæ•°æ® |
| GET | `/api/stats/comparison` | å¤šç­çº§å¯¹æ¯” |
| GET | `/api/stats/exam/:examId` | è€ƒè¯•ç»Ÿè®¡åˆ†æ |
| GET | `/api/stats/progress/:studentId` | å­¦ç”Ÿè¿›æ­¥åˆ†æ |

### 5.5 AI æ™ºèƒ½åŠŸèƒ½

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/ai/generate-comment` | ç”Ÿæˆå­¦ç”Ÿä¸ªæ€§åŒ–è¯„è¯­ |
| POST | `/api/ai/generate-report` | ç”Ÿæˆç­çº§å­¦æƒ…æŠ¥å‘Šï¼ˆæµå¼ï¼‰ |
| POST | `/api/ai/refresh-report` | åˆ·æ–°ç­çº§å­¦æƒ…æŠ¥å‘Š |
| GET | `/api/ai/comment-history/:studentId` | è·å–è¯„è¯­å†å² |

### 5.6 æ•°æ®å¯¼å‡º

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/export/class/:classId` | å¯¼å‡ºç­çº§æˆç»© |

### 5.7 é‡ç‚¹å…³æ³¨åˆ†æ

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/analysis/focus/:classId` | é‡ç‚¹å…³æ³¨åå• |
| GET | `/api/analysis/class/summary/:classId` | ç­çº§åˆ†ææ€»ç»“ |

## ğŸ“Š 6. å‰ç«¯é¡µé¢æ¨¡å—

| é¡µé¢ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| ä»ªè¡¨ç›˜ | `/dashboard` | å…³é”®æŒ‡æ ‡æ¦‚è§ˆ |
| æˆç»©åˆ—è¡¨ | `/scores` | æˆç»©æŸ¥è¯¢ä¸ç®¡ç† |
| ç­çº§å­¦æƒ…åˆ†æ | `/class-analysis` | å¤šç»´åº¦ç­çº§åˆ†æ |
| å­¦ç”Ÿæ¡£æ¡ˆ | `/students/:id` | å­¦ç”Ÿè¯¦æƒ…ä¸AIè¯„è¯­ |
| é‡ç‚¹å…³æ³¨ | `/management-alerts` | ä¸´ç•Œç”Ÿ/é€€æ­¥ç”Ÿ/æ³¢åŠ¨ç”Ÿ |
| æ•°æ®å¯¼å…¥ | `/import` | Excel/AI å›¾ç‰‡å¯¼å…¥ |
| ç­çº§ç®¡ç† | `/classes` | ç­çº§CRUDä¸æ•™å¸ˆåˆ†é… |
| å­¦ç”Ÿç®¡ç† | `/students` | å­¦ç”ŸCRUD |
| è€ƒè¯•ç®¡ç† | `/exams` | è€ƒè¯•CRUD |
| ç”¨æˆ·ç®¡ç† | `/users` | ç”¨æˆ·CRUDï¼ˆç®¡ç†å‘˜ï¼‰ |
| æ“ä½œæ—¥å¿— | `/logs` | å®¡è®¡æ—¥å¿—æŸ¥çœ‹ |

## ğŸ“ˆ 7. æ•°æ®å¯è§†åŒ–å›¾è¡¨

### ç­çº§å­¦æƒ…åˆ†æé¡µé¢å›¾è¡¨

1. **å¹´çº§ç­çº§å¯¹æ¯”é›·è¾¾å›¾** - å¯¹æ¯”å½“å‰ç­çº§ä¸å¹´çº§å¹³å‡çš„å„ç»´åº¦æŒ‡æ ‡
2. **æˆç»©åˆ†å¸ƒå †å æŸ±çŠ¶å›¾** - å±•ç¤ºå„ç§‘ç›®ä¸åŠæ ¼/åŠæ ¼/è‰¯å¥½/ä¼˜ç§€äººæ•°
3. **ç­çº§ç§‘ç›®è¶‹åŠ¿æŠ˜çº¿å›¾** - å„ç§‘ç›®å†æ¬¡è€ƒè¯•å¹³å‡åˆ†å˜åŒ–
4. **å­¦ç”Ÿæ’åä½ç½®æ°”æ³¡å›¾** - å­¦ç”Ÿæˆç»©ä¸æ’åçš„åˆ†å¸ƒæƒ…å†µ

### å­¦ç”Ÿæ¡£æ¡ˆé¡µé¢å›¾è¡¨

1. **æˆç»©è¶‹åŠ¿æŠ˜çº¿å›¾** - å­¦ç”Ÿå†æ¬¡è€ƒè¯•æˆç»©å˜åŒ–
2. **å­¦ç§‘é›·è¾¾å›¾** - å­¦ç”Ÿå„ç§‘ç›®èƒ½åŠ›å¯¹æ¯”
3. **æˆç»©æ³¢åŠ¨åˆ†æå›¾** - æˆç»©ç¨³å®šæ€§åˆ†æ

## ğŸ› ï¸ 8. å¼€å‘ä¸éƒ¨ç½²

### 8.1 ç¯å¢ƒè¦æ±‚
- Node.js 20+
- npm 10+
- Cloudflare è´¦æˆ·

### 8.2 é¡¹ç›®åˆå§‹åŒ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Misaka450/bao-class.git
cd bao-class

# å®‰è£…ä¾èµ– (ä½¿ç”¨ npm workspaces)
npm install
```

### 8.3 æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨åç«¯ (api ç›®å½•)
cd api && npm run dev

# å¯åŠ¨å‰ç«¯ (frontend ç›®å½•)
cd frontend && npm run dev
```

### 8.4 åˆå§‹åŒ–æ•°æ®åº“

è®¿é—® `http://localhost:8787/api/init/all` åˆå§‹åŒ–æ•°æ®åº“å’Œæµ‹è¯•æ•°æ®

### 8.5 éƒ¨ç½²

```bash
# éƒ¨ç½²åç«¯
cd api && npx wrangler deploy

# éƒ¨ç½²å‰ç«¯
cd frontend && npm run build
npx wrangler pages deploy dist --project-name=bao-class
```

## ğŸ” 9. æƒé™è¯´æ˜

| è§’è‰² | æƒé™ |
|------|------|
| **ç®¡ç†å‘˜** (admin) | å…¨éƒ¨åŠŸèƒ½è®¿é—® |
| **ç­ä¸»ä»»** (head_teacher) | ç®¡ç†æœ¬ç­çº§ã€æŸ¥çœ‹æœ¬ç­çº§åˆ†æã€ç”Ÿæˆ AI æŠ¥å‘Š |
| **ç§‘ä»»æ•™å¸ˆ** (subject_teacher) | æŸ¥çœ‹åˆ†é…ç­çº§çš„æˆç»© |

## ğŸ“ 10. æ›´æ–°æ—¥å¿—

### v1.1.0 (2025-12)
- AI æ™ºèƒ½è¯†åˆ«å¯¼å…¥æˆç»©ï¼ˆLlama 3.2 Visionï¼‰
- ç­çº§å­¦æƒ…æŠ¥å‘Š AI ç”Ÿæˆï¼ˆQwen3-30Bï¼Œæµå¼è¾“å‡ºï¼‰
- å¹´çº§ç­çº§å¯¹æ¯”é›·è¾¾å›¾
- æˆç»©åˆ†å¸ƒå †å æŸ±çŠ¶å›¾
- å­¦ç”Ÿæ’åä½ç½®æ°”æ³¡å›¾
- ç§‘ä»»æ•™å¸ˆç®¡ç†åŠŸèƒ½
- æš—è‰²ä¸»é¢˜æ”¯æŒ

### v1.0.0 (2025-12)
- å®Œæ•´çš„æˆç»©ç®¡ç†åŠŸèƒ½
- AI æ™ºèƒ½è¯„è¯­ç”Ÿæˆ
- æ•°æ®åˆ†æå’Œå¯è§†åŒ–
- é‡ç‚¹å…³æ³¨åå•
- è‡ªåŠ¨åŒ– CI/CD éƒ¨ç½²

## ğŸ—ï¸ 11. ç±»å‹ç³»ç»Ÿ

### ç±»å‹æ–‡ä»¶åˆ†å¸ƒ

| ä½ç½® | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `packages/types/` | å…±äº«ç±»å‹ | User, Class, Student, Score ç­‰åŸºç¡€å®ä½“ |
| `frontend/src/types/` | å‰ç«¯ä¸“ç”¨ | ExamQuality, FocusGroupResult ç­‰ |
| `api/src/types/` | åç«¯ä¸“ç”¨ | Env, JWTPayload ç­‰è¿è¡Œæ—¶ç±»å‹ |

### Zod éªŒè¯æ¨¡å¼

æ‰€æœ‰ API è¾“å…¥éªŒè¯ä½¿ç”¨ Zodï¼Œä½äº `api/src/schemas/`ï¼š

| Schema æ–‡ä»¶ | ç”¨é€” |
|------------|------|
| `common.schema.ts` | é€šç”¨éªŒè¯ï¼ˆIDã€åˆ†é¡µã€æ—¥æœŸèŒƒå›´ï¼‰ |
| `auth.schema.ts` | ç™»å½•ã€å¯†ç ä¿®æ”¹éªŒè¯ |
| `scores.schema.ts` | æˆç»©åˆ›å»ºã€æ‰¹é‡æ“ä½œéªŒè¯ |
| `students.schema.ts` | å­¦ç”Ÿ CRUD éªŒè¯ |
| `classes.schema.ts` | ç­çº§ CRUD éªŒè¯ |
| `exams.schema.ts` | è€ƒè¯• CRUD éªŒè¯ |
| `ai.schema.ts` | AI åŠŸèƒ½éªŒè¯ |
| `analysis.schema.ts` | åˆ†æåŠŸèƒ½éªŒè¯ |

### é”™è¯¯ç è§„èŒƒ

åç«¯ä½¿ç”¨æ ‡å‡†é”™è¯¯ç ï¼Œå®šä¹‰äº `api/src/utils/AppError.ts`ï¼š

| é”™è¯¯ç èŒƒå›´ | ç±»åˆ« | ç¤ºä¾‹ |
|-----------|------|------|
| E1xxx | è®¤è¯é”™è¯¯ | E1001 (å‡­è¯æ— æ•ˆ) |
| E2xxx | æƒé™é”™è¯¯ | E2001 (ç¦æ­¢è®¿é—®) |
| E3xxx | èµ„æºé”™è¯¯ | E3001 (èµ„æºä¸å­˜åœ¨) |
| E4xxx | éªŒè¯é”™è¯¯ | E4001 (éªŒè¯å¤±è´¥) |
| E5xxx | æœåŠ¡å™¨é”™è¯¯ | E5001 (å†…éƒ¨é”™è¯¯) |