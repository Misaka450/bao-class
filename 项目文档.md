# ğŸš€ å°å­¦æˆç»©ç®¡ç†ç³»ç»Ÿ (Elementary School Grade Management System)

## 1. é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€æ™ºèƒ½åŒ–çš„ Serverless å°å­¦æˆç»©ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒç®¡ç†å‘˜ã€æ•™å¸ˆã€å­¦ç”Ÿã€å®¶é•¿å››ç±»è§’è‰²ã€‚ç³»ç»Ÿæ—¨åœ¨é€šè¿‡é«˜æ•ˆçš„æ‰¹é‡å¯¼å…¥ã€æ·±åº¦çš„æ™ºèƒ½åˆ†æï¼ˆåˆ©ç”¨ Cloudflare Workers AIï¼‰å’Œé›¶æ•£çš„ Serverless éƒ¨ç½²ï¼Œæå‡æˆç»©ç®¡ç†çš„æ•ˆç‡å’Œæ•™å­¦æŒ‡å¯¼çš„è´¨é‡ã€‚

**æ ¸å¿ƒç›®æ ‡ï¼š**
- **é«˜æ•ˆç®¡ç†**ï¼šæ”¯æŒ Excel æ‰¹é‡å¯¼å…¥æˆç»©ï¼Œå¿«é€Ÿå®Œæˆå½•å…¥ã€‚
- **æ™ºèƒ½åˆ†æ**ï¼šåˆ©ç”¨ AI ç”Ÿæˆè‡ªç„¶è¯­è¨€æ€»ç»“å’Œä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®ã€‚
- **å…¨æ ˆ Serverless**ï¼šåŸºäº Cloudflare Workers, Pages, D1, R2 æ„å»ºã€‚

## ğŸ’» 2. æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯/æœåŠ¡ | ç”¨é€”è¯´æ˜ |
|------|----------|----------|
| **å‰ç«¯** | React 18 + TypeScript + Vite | æ„å»ºç”¨æˆ·ç•Œé¢ |
| **UI æ¡†æ¶** | Tailwind CSS | æ ·å¼è®¾è®¡ | è¦å¥½çœ‹æ—¶å°š | ä¸è¦è€åœŸ|
| **å›¾è¡¨åº“** | Recharts | æ•°æ®å¯è§†åŒ– |
| **åç«¯æ ¸å¿ƒ** | Cloudflare Workers (Hono.js) | API æ¥å£ã€ä¸šåŠ¡é€»è¾‘ã€Excel å¤„ç† |
| **æ•°æ®åº“** | Cloudflare D1 | å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼ˆç”¨æˆ·ã€ç­çº§ã€æˆç»©ç­‰ï¼‰ |
| **æ–‡ä»¶å­˜å‚¨** | Cloudflare R2 | å­˜å‚¨è€ƒå·å›¾ç‰‡ã€PDF æŠ¥å‘Šç­‰ |
| **AI æ™ºèƒ½** | Cloudflare Workers AI | ç”Ÿæˆæˆç»©åˆ†ææ€»ç»“å’Œå»ºè®® |
| **éƒ¨ç½²** | Cloudflare Pages & Workers | å‰åç«¯åˆ†ç¦»éƒ¨ç½² |

## ğŸ›ï¸ 3. ç³»ç»Ÿæ¶æ„

| å±‚æ¬¡ | ç»„ä»¶ | èŒè´£ | ç»‘å®šåç§° (wrangler.toml) |
|------|------|------|----------------------------|
| **å‰ç«¯åº”ç”¨** | Cloudflare Pages | æ‰˜ç®¡ React é™æ€èµ„æº | N/A |
| **API ç½‘å…³** | Hono.js Worker | å¤„ç† API è¯·æ±‚ (/api/*) | N/A |
| **æ•°æ®å±‚** | Cloudflare D1 | å…³ç³»å‹æ•°æ®å­˜å‚¨ | DB |
| **å­˜å‚¨å±‚** | Cloudflare R2 | å¯¹è±¡å­˜å‚¨ (å›¾ç‰‡/æ–‡ä»¶) | ASSET_BUCKET |
| **æ™ºèƒ½å±‚** | Workers AI | LLM æ¨ç†åˆ†æ | AI |

## ğŸ§± 4. æ•°æ®åº“è®¾è®¡ (Cloudflare D1)

### æ ¸å¿ƒè¡¨ç»“æ„

1.  **Users è¡¨ (users)**
    *   `id`: INTEGER PRIMARY KEY
    *   `username`: TEXT UNIQUE (ç™»å½•è´¦å·)
    *   `password`: TEXT (åŠ å¯†å­˜å‚¨)
    *   `role`: TEXT (admin/teacher/student/parent)
    *   `name`: TEXT (æ˜¾ç¤ºå§“å)
    *   `created_at`: TIMESTAMP

2.  **Classes è¡¨ (classes)**
    *   `id`: INTEGER PRIMARY KEY
    *   `name`: TEXT (ç­çº§åç§°)
    *   `grade`: INTEGER (å¹´çº§)
    *   `teacher_id`: INTEGER (ç­ä¸»ä»»ID, å¤–é”® users.id)
    *   `created_at`: TIMESTAMP

3.  **Students è¡¨ (students)**
    *   `id`: INTEGER PRIMARY KEY
    *   `name`: TEXT (å­¦ç”Ÿå§“å)
    *   `student_id`: TEXT (å­¦å·, Unique)
    *   `class_id`: INTEGER (ç­çº§ID, å¤–é”® classes.id)
    *   `parent_id`: INTEGER (å®¶é•¿ID, å¤–é”® users.id, å¯é€‰)
    *   `created_at`: TIMESTAMP

4.  **Courses è¡¨ (courses)**
    *   `id`: INTEGER PRIMARY KEY
    *   `name`: TEXT (è¯¾ç¨‹åç§°)
    *   `grade`: INTEGER (é€‚ç”¨å¹´çº§)
    *   `created_at`: TIMESTAMP

5.  **Exams è¡¨ (exams)**
    *   `id`: INTEGER PRIMARY KEY
    *   `name`: TEXT (è€ƒè¯•åç§°)
    *   `course_id`: INTEGER (è¯¾ç¨‹ID, å¤–é”® courses.id)
    *   `class_id`: INTEGER (ç­çº§ID, å¤–é”® classes.id)
    *   `exam_date`: TEXT (è€ƒè¯•æ—¥æœŸ)
    *   `full_score`: INTEGER (æ»¡åˆ†)
    *   `created_at`: TIMESTAMP

6.  **Scores è¡¨ (scores)**
    *   `id`: INTEGER PRIMARY KEY
    *   `student_id`: INTEGER (å­¦ç”ŸID, å¤–é”® students.id)
    *   `exam_id`: INTEGER (è€ƒè¯•ID, å¤–é”® exams.id)
    *   `score`: REAL (åˆ†æ•°)
    *   `created_at`: TIMESTAMP
    *   `updated_at`: TIMESTAMP

## âš™ï¸ 5. API æ¥å£

### 5.1 åŸºç¡€ç®¡ç† (CRUD)

*   **è®¤è¯**:
    *   `POST /api/auth/login`: ç™»å½•
    *   `GET /api/auth/profile`: è·å–ç”¨æˆ·ä¿¡æ¯
*   **ç­çº§ç®¡ç†**: `GET/POST/PUT/DELETE /api/classes`
*   **å­¦ç”Ÿç®¡ç†**: `GET/POST/PUT/DELETE /api/students`
*   **è¯¾ç¨‹ç®¡ç†**: `GET/POST/PUT/DELETE /api/courses`
*   **è€ƒè¯•ç®¡ç†**: `GET/POST/PUT/DELETE /api/exams`
*   **æˆç»©ç®¡ç†**: `GET/POST/PUT/DELETE /api/scores`

### 5.2 ğŸ“‚ æ‰¹é‡å¯¼å…¥ä¸æ–‡ä»¶

*   `GET /api/template/grades.xlsx`: ä¸‹è½½æˆç»©å¯¼å…¥æ¨¡æ¿
*   `POST /api/import/grades`: æ‰¹é‡å¯¼å…¥æˆç»© (Excel)
*   `POST /api/assets/upload`: ä¸Šä¼ è€ƒå·å›¾ç‰‡ (R2)

### 5.3 ğŸ“Š æ™ºèƒ½åˆ†æ (AI & Stats)

*   `GET /api/stats/class/:classId`: ç­çº§æ€»ä½“åˆ†æ (å¹³å‡åˆ†ã€åˆ†å¸ƒç­‰)
*   `GET /api/stats/student/:studentId`: å­¦ç”Ÿä¸ªäººåˆ†æ (å†å²è¶‹åŠ¿)
*   `GET /api/analysis/class/summary/:classId`: **AI æ€»ç»“æŠ¥å‘Š** (è°ƒç”¨ Workers AI ç”Ÿæˆç­çº§æˆç»©æ€»ç»“)
*   `GET /api/analysis/student/advice/:studentId`: **AI ä¸ªæ€§åŒ–å»ºè®®** (è°ƒç”¨ Workers AI ç”Ÿæˆå­¦ä¹ å»ºè®®)
*   `GET /api/analysis/weakpoints/:classId`: è–„å¼±ç¾¤ä½“è¯†åˆ«

### 5.4 ğŸ“ˆ æ·±åº¦æ•™å­¦åˆ†æ (Advanced Analytics)

é’ˆå¯¹ç­ä¸»ä»»å’Œå­¦ç§‘æ•™å¸ˆçš„æ·±åº¦åˆ†æéœ€æ±‚ï¼Œæä¾›å¤šç»´åº¦çš„å¯è§†åŒ–æŠ¥è¡¨ï¼š

1.  **æ¨ªå‘å¯¹æ¯”åˆ†æ (Class Comparison)**
    *   `GET /api/analysis/comparison/classes?examId=<ID>`
    *   **ç»´åº¦**: å¹³å‡åˆ†ã€åŠæ ¼ç‡ (>=60%)ã€ä¼˜ç§€ç‡ (>=90%)ã€ä½åˆ†ç‡ (<60%)ã€‚
    *   **å¯è§†åŒ–**: å¤šç³»åˆ—æŸ±çŠ¶å›¾ (Multi-series Bar Chart) æˆ– ç®±çº¿å›¾ (Box Plot)ï¼Œç›´è§‚å±•ç¤ºå„ç­çº§æˆç»©åˆ†å¸ƒå·®å¼‚ã€‚

2.  **å­¦ç”Ÿåç§‘åˆ†æ (Subject Bias)**
    *   `GET /api/analysis/student/radar/:studentId`
    *   **ç»´åº¦**: å­¦ç”Ÿå„ç§‘æˆç»©çš„æ ‡å‡†åˆ† (Z-score) ä¸ç­çº§å¹³å‡æ°´å¹³çš„å¯¹æ¯”ã€‚
    *   **å¯è§†åŒ–**: é›·è¾¾å›¾ (Radar Chart)ï¼Œç›´è§‚å±•ç¤ºå­¦ç”Ÿçš„ä¼˜åŠ¿å­¦ç§‘å’ŒçŸ­æ¿å­¦ç§‘ã€‚

3.  **æˆç»©åˆ†æ®µç»Ÿè®¡ (Score Segmentation)**
    *   `GET /api/analysis/class/segments/:classId?examId=<ID>`
    *   **ç»´åº¦**: [90-100], [80-89], [70-79], [60-69], [<60] å„åˆ†æ•°æ®µäººæ•°å æ¯”ã€‚
    *   **å¯è§†åŒ–**: å †å æŸ±çŠ¶å›¾ (Stacked Bar Chart) æˆ– é¥¼å›¾ (Pie Chart)ã€‚

4.  **è¿›æ­¥ä¸ç¨³å®šæ€§ (Progress & Stability)**
    *   `GET /api/analysis/student/trend/:studentId`
    *   **ç»´åº¦**: è¿‘ 3-5 æ¬¡è€ƒè¯•çš„ç­çº§/å¹´çº§æ’åå˜åŒ–è¶‹åŠ¿ï¼›æˆç»©æ–¹å·® (ç¨³å®šæ€§)ã€‚
    *   **å¯è§†åŒ–**: æŠ˜çº¿å›¾ (Line Chart) é…åˆè¶‹åŠ¿çº¿ï¼Œè¯†åˆ«â€œæ½œåŠ›è‚¡â€å’Œâ€œæ»‘å¡â€å­¦ç”Ÿã€‚

5.  **é‡ç‚¹å…³æ³¨åå• (Focus Group)**
    *   `GET /api/analysis/class/focus/:classId`
    *   **é€»è¾‘**: è‡ªåŠ¨ç­›é€‰ä»¥ä¸‹ç±»å‹çš„å­¦ç”Ÿï¼š
        *   **ä¸´ç•Œç”Ÿ**: è·ç¦»åŠæ ¼çº¿æˆ–ä¼˜ç§€çº¿ä»…å·® 1-2 åˆ†çš„å­¦ç”Ÿã€‚
        *   **æ³¢åŠ¨ç”Ÿ**: æˆç»©èµ·ä¼å‰§çƒˆï¼Œæ–¹å·®è¿‡å¤§çš„å­¦ç”Ÿã€‚
        *   **é€€æ­¥ç”Ÿ**: è¿ç»­ä¸¤æ¬¡è€ƒè¯•æ’åä¸‹é™è¶…è¿‡ 5 åçš„å­¦ç”Ÿã€‚

## ğŸ› ï¸ 6. å¼€å‘ä¸éƒ¨ç½²

### 6.1 ç¯å¢ƒè¦æ±‚
*   Node.js 18+
*   Cloudflare è´¦æˆ·

### 6.2 é¡¹ç›®åˆå§‹åŒ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Misaka450/bao-class.git
cd bao-class

# å®‰è£…ä¾èµ–
cd api && npm install
cd ../frontend && npm install
```

### 6.3 æ•°æ®åº“é…ç½®

```bash
# åˆ›å»º D1 æ•°æ®åº“
wrangler d1 create class

# åˆå§‹åŒ–è¡¨ç»“æ„
wrangler d1 execute class --file=src/db/schema.sql

# æ’å…¥æµ‹è¯•æ•°æ®
wrangler d1 execute class --command "INSERT INTO users (username, password, role, name) VALUES ('admin', '...', 'admin', 'ç®¡ç†å‘˜')"
```

### 6.4 æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨åç«¯ (api ç›®å½•)
npm run dev

# å¯åŠ¨å‰ç«¯ (frontend ç›®å½•)
npm run dev
```

### 6.5 éƒ¨ç½²é…ç½® (api/wrangler.toml)

```toml
name = "bao-class-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

[vars]
JWT_SECRET = "YOUR_SECRET"

[[d1_databases]]
binding = "DB"
database_name = "class"
database_id = "6e013f8f-0b3b-4674-abad-fa81fb5e22bc"

[[r2_buckets]]
binding = "ASSET_BUCKET"
bucket_name = "class"

[[ai]]
binding = "AI"
```