name = "bao-class-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
account_id = "02cefa4c2401a3f9c36ef7c6dbf5ce39"

# CPU 时间限制 (付费版最高 300000ms = 5分钟)
# 用于支持 PDF 解析等耗时操作
[limits]
cpu_ms = 60000

# 添加自定义域名路由配置
routes = [
  { pattern = "api.980823.xyz/*", zone_name = "980823.xyz" },
]

[vars]
ENVIRONMENT = "production"
# 注意：JWT_SECRET 应该通过 wrangler secret put JWT_SECRET 命令设置，而不是硬编码在这里
# DASHSCOPE_API_KEY 应该通过 wrangler secret put DASHSCOPE_API_KEY 命令设置

# 可观察性配置
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
persist = true
head_sampling_rate = 1

# D1 数据库配置
[[d1_databases]]
binding = "DB"
database_name = "class"
database_id = "6e013f8f-0b3b-4674-abad-fa81fb5e22bc"

# KV 命名空间配置
[[kv_namespaces]]
binding = "KV"
id = "ca803a51af3741ecb8db56ea055f7656"

# R2 存储桶配置
[[r2_buckets]]
binding = "R2"
bucket_name = "class"

# AI 绑定配置
[ai]
binding = "AI"

# 教材存储桶配置
[[r2_buckets]]
binding = "TEXTBOOKS"
bucket_name = "pep-textbooks"

# Vectorize 向量数据库
[[vectorize]]
binding = "VECTORIZE"
index_name = "textbook-index"